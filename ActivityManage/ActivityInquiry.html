<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>校园社团活动查询</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/layuimini.css" media="all">
</head>
<body>
<div>	
        <!-- 工具栏：添加活动和批量删除活动按钮 -->
		<script type="text/html" id="activityTableToolbar">
			<div class="layui-btn-container">
				<button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 添加社团活动 </button>
				<button class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="delete"> 批量删除活动 </button>
			</div>
		</script>

       <!-- 活动表格 -->
		<table class="layui-hide" id="activityTable" lay-filter="activityTableFilter"></table>

		<!-- 活动状态列：进行中/已结束 -->
		<script type="text/html" id="activityStatus">
			<input type="checkbox" name="status" lay-skin="switch" lay-text="进行中|已结束" lay-event="open" lay-filter="modifyActivityStatus" {{ d.status == '1'? 'checked' : '' }}/>
		</script>

        <!-- 操作列：查看详情、编辑活动、删除活动按钮 -->
		<script type="text/html" id="activityTableOperation">
			<a class="layui-btn layui-btn-normal layui-btn-xs data-count-edit" lay-event="detail" >查看详情</a>
			<a class="layui-btn  layui-btn-xs data-count-edit" lay-event="edit">编辑活动</a>
			<a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除活动</a>
		</script>
</div>
<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
<script>
	// 引用Layui核心模块
	layui.use(['form', 'table', 'layer'], function () {
		var $ = layui.jquery;     
			form = layui.form;    
			table = layui.table;  
			layer = layui.layer;
			
        // 1、渲染社团活动表格
		table.render({
			elem: '#activityTable',
			url: 'activity.json', // 数据源
			toolbar: '#activityTableToolbar', // 关联工具栏
			defaultToolbar: ['filter', 'exports', 'print', {
				title: '活动查询提示',
				layEvent: 'LAYTABLE_TIPS',
				icon: 'layui-icon-tips'
			}],
			cols: [[
				{type: "checkbox", width: 50},
				{field: 'activityId', width: 80, title: '活动ID', sort: true},
				{field: 'activityName', width: 200, title: '活动名称'},
				{field: 'clubName', width: 150, title: '举办社团'},
				{field: 'activityTime', width: 180, title: '活动时间', sort: true},
				{field: 'activityLocation', width: 180, title: '活动地点'},
				{field: 'activityType', width: 120, title: '活动类型'},
				{field: 'signupCount', width: 100, title: '报名人数', sort: true},
				{
					field : 'status',
					width: 150,
					title : '活动状态',
					templet : '#activityStatus',
					unresize : true,
					align: "center"
				},
				{title: '操作', minWidth: 130, toolbar: '#activityTableOperation', align: "center"}
			]],
			limits: [10, 15, 20, 25, 50, 100],
			limit: 15,
			page: true,
			skin: 'line'
		});	 
 
		/**
		 * 2、工具栏监听：添加活动/批量删除
		 */
		table.on('toolbar(activityTableFilter)', function (obj) {
		    if (obj.event === 'add') {  // 添加活动
				var index = layer.open({
					title: '添加校园社团活动',
					type: 2,
					shade: 0.2,
					maxmin: true,
					shadeClose: true,
					area: ['100%', '100%'],
					content: './activity/addActivity.html',
				});
				$(window).on("resize", function () {
					layer.full(index);
				});
			} else if (obj.event === 'delete') {  // 批量删除活动
				var checkStatus = table.checkStatus('activityTable')
						, data = checkStatus.data;
				if (data.length === 0) {
					layer.msg('请先选择要删除的活动', {icon: 2});
					return;
				}
				layer.confirm('确认删除选中的 ' + data.length + ' 个活动？', {icon: 3}, function (index) {
					// 实际项目中需添加AJAX请求删除后端数据
					layer.msg('批量删除成功', {icon: 1});
					layer.close(index);
				});
			}
		});

		// 3、监听表格复选框选择
		table.on('checkbox(activityTableFilter)', function (obj) {
			console.log('选中的活动数据：', obj.data);
		});
         
		// 4、监听操作列按钮（查看/编辑/删除活动）
		table.on('tool(activityTableFilter)', function (obj) {
			var data = obj.data; // 当前行活动数据
			if (obj.event === 'detail') { // 查看详情 - 跳转到ClubShow.html
				// 携带活动ID参数跳转
				window.location.href = 'file:///D:/nuc111/111/校园社团活动及报名平台/ClubManage/ClubShow.html?activityId=' + (data.activityId || '');
			} else if (obj.event === 'edit') { // 编辑活动 - 跳转到ActivityEdit.html
				// 携带活动ID参数跳转
				window.location.href = 'file:///D:/nuc111/111/校园社团活动及报名平台/ActivityManage/ActivityEdit.html?activityId=' + (data.activityId || '');
			} else if (obj.event === 'delete') { // 单个删除活动
				layer.confirm('确认删除活动【' + data.activityName + '】？', {icon: 3}, function (index) {
					// 实际项目中需添加AJAX请求删除后端数据
					obj.del(); // 前端表格删除当前行
					layer.msg('活动删除成功', {icon: 1});
					layer.close(index);
				});
			}
		});

	});
</script>

</body>
</html>
